<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>BlueDog - Enhanced Address Sniffer</title>
    
    <!-- iOS Status Bar Meta Tags - FIXED -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#000000">
    <meta name="apple-mobile-web-app-title" content="BlueDog">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        'ios-blue': '#007AFF',
                        'ios-gray': '#F2F2F7',
                        'ios-gray-dark': '#1C1C1E',
                        'ios-secondary': '#8E8E93',
                        'ios-card': 'rgba(255, 255, 255, 0.1)',
                        'ios-card-dark': 'rgba(28, 28, 30, 0.8)'
                    },
                    fontFamily: {
                        'ios': ['-apple-system', 'BlinkMacSystemFont', 'SF Pro Display', 'Segoe UI', 'Roboto', 'sans-serif']
                    },
                    animation: {
                        'bounce-subtle': 'bounce-subtle 0.6s ease-out',
                        'slide-up': 'slide-up 0.4s ease-out',
                        'fade-in': 'fade-in 0.3s ease-out',
                        'progress': 'progress 2.5s ease-out forwards',
                        'pulse-ios': 'pulse-ios 2s ease-in-out infinite',
                        'slide-down': 'slide-down 0.3s ease-out',
                        'pulse-fast': 'pulse-fast 1s ease-in-out infinite',
                        'shake': 'shake 0.5s ease-in-out'
                    },
                    keyframes: {
                        'bounce-subtle': {
                            '0%': { transform: 'scale(0.95)', opacity: '0' },
                            '50%': { transform: 'scale(1.02)' },
                            '100%': { transform: 'scale(1)', opacity: '1' }
                        },
                        'slide-up': {
                            '0%': { transform: 'translateY(20px)', opacity: '0' },
                            '100%': { transform: 'translateY(0)', opacity: '1' }
                        },
                        'slide-down': {
                            '0%': { transform: 'translateY(-20px)', opacity: '0' },
                            '100%': { transform: 'translateY(0)', opacity: '1' }
                        },
                        'fade-in': {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' }
                        },
                        'progress': {
                            '0%': { width: '0%' },
                            '100%': { width: '100%' }
                        },
                        'pulse-ios': {
                            '0%, 100%': { opacity: '1' },
                            '50%': { opacity: '0.5' }
                        },
                        'pulse-fast': {
                            '0%, 100%': { opacity: '1' },
                            '50%': { opacity: '0.3' }
                        },
                        'shake': {
                            '0%, 100%': { transform: 'translateX(0)' },
                            '10%, 30%, 50%, 70%, 90%': { transform: 'translateX(-2px)' },
                            '20%, 40%, 60%, 80%': { transform: 'translateX(2px)' }
                        }
                    },
                    borderRadius: {
                        'ios': '10px',
                        'ios-lg': '16px',
                        'ios-xl': '20px'
                    }
                }
            }
        }
    </script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #000000 0%, #1a1a1a 100%);
            color: white;
            line-height: 1.5;
            -webkit-font-smoothing: antialiased;
            min-height: 100vh;
            padding-top: env(safe-area-inset-top);
            padding-bottom: env(safe-area-inset-bottom);
            padding-left: env(safe-area-inset-left);
            padding-right: env(safe-area-inset-right);
        }
        
        /* Safe area insets for iPhone X+ */
        .safe-area-top {
            padding-top: env(safe-area-inset-top, 20px);
            padding-left: env(safe-area-inset-left, 0);
            padding-right: env(safe-area-inset-right, 0);
        }
        
        .safe-area-bottom {
            padding-bottom: env(safe-area-inset-bottom, 20px);
            padding-left: env(safe-area-inset-left, 0);
            padding-right: env(safe-area-inset-right, 0);
        }
        
        /* iOS specific optimizations */
        @supports (-webkit-touch-callout: none) {
            /* iOS-specific styles */
            .ios-scroll {
                -webkit-overflow-scrolling: touch;
            }
            
            /* Better tap highlighting */
            button, .ios-button, .list-item {
                -webkit-tap-highlight-color: rgba(0, 122, 255, 0.1);
            }
        }
        
        /* Add responsive padding for iOS devices */
        @media only screen and (max-device-width: 812px) and (-webkit-min-device-pixel-ratio: 3) {
            .px-6 {
                padding-left: max(1.5rem, env(safe-area-inset-left));
                padding-right: max(1.5rem, env(safe-area-inset-right));
            }
        }
        
        .ios-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .ios-button {
            background: rgba(0, 122, 255, 0.1);
            border: 1px solid rgba(0, 122, 255, 0.3);
            transition: all 0.2s ease;
            -webkit-tap-highlight-color: transparent;
        }
        
        .ios-button:hover, .ios-button:active {
            background: rgba(0, 122, 255, 0.2);
            border-color: rgba(0, 122, 255, 0.5);
            transform: translateY(-1px);
        }
        
        .ios-button:active {
            transform: translateY(0px);
        }
        
        .crypto-icon {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 14px;
        }
        
        .progress-container {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            overflow: hidden;
            position: relative;
        }
        
        .progress-bar {
            background: linear-gradient(90deg, #007AFF, #00D4FF);
            height: 100%;
            border-radius: 8px;
            position: relative;
            overflow: hidden;
        }
        
        .progress-bar::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            animation: shimmer 1.5s infinite;
        }
        
        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
        
        .wallet-info-item {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #34C759;
            animation: pulse-ios 2s ease-in-out infinite;
        }
        
        .status-dot.solana-loading {
            background: #9945FF;
            animation: pulse-fast 1s ease-in-out infinite;
        }
        
        /* iOS Toggle Switch */
        .toggle-switch {
            width: 42px;
            height: 24px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            position: relative;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        
        .toggle-switch.active {
            background: #007AFF;
        }
        
        .toggle-slider {
            width: 20px;
            height: 20px;
            background: white;
            border-radius: 50%;
            position: absolute;
            top: 2px;
            left: 2px;
            transition: transform 0.3s ease;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        
        .toggle-switch.active .toggle-slider {
            transform: translateX(18px);
        }
        
        /* Compact address display */
        .address-compact {
            font-family: 'SF Mono', 'Monaco', 'Menlo', monospace;
            font-size: 11px;
            color: #8E8E93;
        }
        
        .balance-compact {
            font-size: 14px;
            font-weight: 600;
        }
        
        .list-item {
            transition: all 0.2s ease;
        }
        
        .list-item:active {
            transform: scale(0.98);
            background: rgba(255, 255, 255, 0.05);
        }

        /* New styles for enhanced features */
        .favorite-btn {
            transition: all 0.2s ease;
        }
        
        .favorite-btn.active {
            color: #FF9500;
        }
        
        .risk-low { color: #34C759; }
        .risk-medium { color: #FF9500; }
        .risk-high { color: #FF3B30; }
        
        .modal {
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }
        
        .tab-button {
            border-bottom: 2px solid transparent;
            transition: all 0.2s ease;
        }
        
        .tab-button.active {
            border-bottom-color: #007AFF;
            color: #007AFF;
        }
        
        .notification {
            position: fixed;
            top: max(env(safe-area-inset-top), 20px);
            left: 50%;
            transform: translateX(-50%) translateY(-100%);
            z-index: 100;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 12px 20px;
            font-size: 14px;
            color: white;
            transition: transform 0.3s ease;
            max-width: 90vw;
            text-align: center;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }
        
        .notification.show {
            transform: translateX(-50%) translateY(0);
        }
        
        .notification.success {
            border-color: #34C759;
            background: rgba(52, 199, 89, 0.15);
        }
        
        .notification.error {
            border-color: #FF3B30;
            background: rgba(255, 59, 48, 0.15);
        }
        
        .notification.warning {
            border-color: #FF9500;
            background: rgba(255, 149, 0, 0.15);
        }
        
        input, textarea {
            font-size: 16px; /* Prevent zoom on iOS */
        }

        /* Solana loading indicator */
        .solana-loading-indicator {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            font-size: 10px;
            color: #9945FF;
        }

        /* Storage status indicator */
        .storage-status {
            position: fixed;
            bottom: max(env(safe-area-inset-bottom), 20px);
            right: max(env(safe-area-inset-right), 20px);
            z-index: 30;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 8px 12px;
            font-size: 11px;
            color: #8E8E93;
            transform: translateY(100px);
            transition: transform 0.3s ease;
        }

        .storage-status.show {
            transform: translateY(0);
        }

        .storage-status.success {
            color: #34C759;
            border-color: #34C759;
        }

        .storage-status.error {
            color: #FF3B30;
            border-color: #FF3B30;
        }

        /* Network status indicator */
        .network-offline .status-dot {
            background: #FF9500 !important;
            animation: none;
        }

        /* Enhanced address list items */
        .address-item {
            transition: all 0.2s ease;
            cursor: pointer;
        }
        
        .address-item:hover {
            transform: translateY(-2px);
        }
        
        .address-item:active {
            transform: translateY(0px);
        }

        /* Loading skeleton */
        .skeleton {
            background: linear-gradient(90deg, rgba(255,255,255,0.05) 25%, rgba(255,255,255,0.1) 50%, rgba(255,255,255,0.05) 75%);
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite;
        }

        /* Copy feedback animation */
        .copy-success {
            animation: shake 0.5s ease-in-out;
            color: #34C759 !important;
        }

        /* Bulk results counter */
        .results-counter {
            position: sticky;
            top: 0;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            z-index: 10;
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <!-- Storage Status Indicator -->
    <div id="storageStatus" class="storage-status">
        <div class="flex items-center space-x-2">
            <div class="w-2 h-2 bg-current rounded-full animate-pulse"></div>
            <span id="storageStatusText">Data saved</span>
        </div>
    </div>

    <!-- Notification Bar -->
    <div id="notification" class="notification">
        Address added to watchlist!
    </div>

    <!-- Loading Screen -->
    <div id="loadingScreen" class="fixed inset-0 z-50 flex flex-col items-center justify-center bg-black safe-area-top safe-area-bottom">
        <div class="absolute inset-0 bg-cover bg-center bg-no-repeat opacity-30" 
             style="background-image: url('https://pfst.cf2.poecdn.net/base/image/bcc0a9e87100152e11395aa288eb7f860f74d1c1311fb3664185962a09635e5d?w=1024&h=1024');"></div>
        
        <div class="relative z-10 text-center px-8 max-w-sm w-full">
            <h1 class="text-3xl font-bold mb-2 text-white">BlueDog</h1>
            <p class="text-ios-secondary text-lg mb-8">Enhanced Address Sniffer</p>
            
            <!-- iOS Style Progress Bar -->
            <div class="progress-container h-2 mb-4">
                <div class="progress-bar animate-progress"></div>
            </div>
            <p class="text-sm text-ios-secondary">Loading advanced features...</p>
        </div>
    </div>

    <!-- Side Menu Overlay -->
    <div id="menuOverlay" class="hidden fixed inset-0 bg-black bg-opacity-50 z-40" onclick="closeMenu()"></div>
    
    <!-- Side Menu -->
    <div id="sideMenu" class="fixed top-0 right-0 h-full w-80 max-w-[85vw] bg-black/95 backdrop-blur-lg border-l border-white/10 transform translate-x-full transition-transform duration-300 z-50 safe-area-top safe-area-bottom">
        <div class="p-6 ios-scroll" style="height: calc(100% - env(safe-area-inset-top) - env(safe-area-inset-bottom)); overflow-y: auto;">
            <!-- Menu Header -->
            <div class="flex items-center justify-between mb-8">
                <div>
                    <h2 class="text-xl font-bold text-white">Menu</h2>
                    <p class="text-sm text-ios-secondary">BlueDog Settings</p>
                </div>
                <button onclick="closeMenu()" class="ios-button p-2 rounded-ios">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Menu Items -->
            <div class="space-y-3">
                <button onclick="toggleViewMode()" class="w-full ios-card p-4 rounded-ios text-left address-item">
                    <div class="flex items-center space-x-3">
                        <div class="w-10 h-10 bg-blue-500/20 rounded-ios flex items-center justify-center">
                            <svg class="w-5 h-5 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"></path>
                            </svg>
                        </div>
                        <div class="flex-1">
                            <div class="text-white font-medium">Toggle View Mode</div>
                            <div class="text-ios-secondary text-sm" id="currentViewMode">Single Address View</div>
                        </div>
                        <svg class="w-4 h-4 text-ios-secondary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                        </svg>
                    </div>
                </button>
                
                <button onclick="exportAllData()" class="w-full ios-card p-4 rounded-ios text-left address-item">
                    <div class="flex items-center space-x-3">
                        <div class="w-10 h-10 bg-green-500/20 rounded-ios flex items-center justify-center">
                            <svg class="w-5 h-5 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                            </svg>
                        </div>
                        <div class="flex-1">
                            <div class="text-white font-medium">Export All Data</div>
                            <div class="text-ios-secondary text-sm">Download complete history</div>
                        </div>
                        <svg class="w-4 h-4 text-ios-secondary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                        </svg>
                    </div>
                </button>
                
                <button onclick="clearAllHistory()" class="w-full ios-card p-4 rounded-ios text-left address-item">
                    <div class="flex items-center space-x-3">
                        <div class="w-10 h-10 bg-red-500/20 rounded-ios flex items-center justify-center">
                            <svg class="w-5 h-5 text-red-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                            </svg>
                        </div>
                        <div class="flex-1">
                            <div class="text-white font-medium">Clear History</div>
                            <div class="text-ios-secondary text-sm">Remove all saved data</div>
                        </div>
                        <svg class="w-4 h-4 text-ios-secondary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                        </svg>
                    </div>
                </button>
                
                <button onclick="showStats()" class="w-full ios-card p-4 rounded-ios text-left address-item">
                    <div class="flex items-center space-x-3">
                        <div class="w-10 h-10 bg-purple-500/20 rounded-ios flex items-center justify-center">
                            <svg class="w-5 h-5 text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                            </svg>
                        </div>
                        <div class="flex-1">
                            <div class="text-white font-medium">Usage Statistics</div>
                            <div class="text-ios-secondary text-sm">View your activity stats</div>
                        </div>
                        <svg class="w-4 h-4 text-ios-secondary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                        </svg>
                    </div>
                </button>
                
                <button onclick="showAbout()" class="w-full ios-card p-4 rounded-ios text-left address-item">
                    <div class="flex items-center space-x-3">
                        <div class="w-10 h-10 bg-orange-500/20 rounded-ios flex items-center justify-center">
                            <svg class="w-5 h-5 text-orange-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                        <div class="flex-1">
                            <div class="text-white font-medium">About BlueDog</div>
                            <div class="text-ios-secondary text-sm">App info and credits</div>
                        </div>
                        <svg class="w-4 h-4 text-ios-secondary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                        </svg>
                    </div>
                </button>
            </div>
            
            <!-- Storage Status -->
            <div class="mt-8 p-4 ios-card rounded-ios">
                <div class="flex items-center space-x-2 mb-2">
                    <div class="w-3 h-3 rounded-full" id="storageStatusIndicator"></div>
                    <h3 class="text-white font-medium text-sm" id="storageStatusTitle">Storage Status</h3>
                </div>
                <p class="text-xs text-ios-secondary" id="storageStatusDescription">Data persistence enabled</p>
            </div>
            
            <!-- Stats Summary -->
            <div class="mt-4 p-4 ios-card rounded-ios">
                <h3 class="text-white font-medium mb-3">Quick Stats</h3>
                <div class="grid grid-cols-2 gap-4 text-center">
                    <div>
                        <div class="text-lg font-bold text-white" id="totalSearches">0</div>
                        <div class="text-xs text-ios-secondary">Searches</div>
                    </div>
                    <div>
                        <div class="text-lg font-bold text-white" id="totalWatchlist">0</div>
                        <div class="text-xs text-ios-secondary">Watchlist</div>
                    </div>
                </div>
            </div>

            <!-- Network Status -->
            <div class="mt-4 p-4 ios-card rounded-ios">
                <h3 class="text-white font-medium mb-3">Network Status</h3>
                <div class="flex items-center space-x-2">
                    <div class="w-3 h-3 rounded-full" id="networkStatusIndicator"></div>
                    <span class="text-xs" id="networkStatusText">Online</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Main App -->
    <div id="mainApp" class="hidden min-h-screen">
        <!-- Header -->
        <div class="safe-area-top bg-black/20 backdrop-blur-lg border-b border-white/10">
            <div class="px-6 py-4">
                <div class="flex items-center justify-between">
                    <div>
                        <h1 class="text-2xl font-bold text-white">BlueDog</h1>
                        <p class="text-sm text-ios-secondary">Enhanced Address Sniffer</p>
                    </div>
                    <div class="flex items-center space-x-3">
                        <div class="flex items-center space-x-2">
                            <div class="status-dot" id="statusDot"></div>
                            <span class="text-xs text-ios-secondary" id="statusText">Live</span>
                        </div>
                        <!-- Menu Button -->
                        <button id="menuBtn" onclick="toggleMenu()" class="ios-button p-2 rounded-ios address-item">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                            </svg>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tab Navigation -->
        <div id="tabNavigation" class="hidden px-6 py-3 bg-black/10 border-b border-white/10">
            <div class="flex space-x-6">
                <button onclick="switchTab('search')" class="tab-button active text-sm font-medium py-2" id="searchTab">
                    Search
                </button>
                <button onclick="switchTab('watchlist')" class="tab-button text-sm font-medium py-2" id="watchlistTab">
                    Watchlist (<span id="watchlistCount">0</span>)
                </button>
                <button onclick="switchTab('history')" class="tab-button text-sm font-medium py-2" id="historyTab">
                    History
                </button>
                <button onclick="switchTab('bulk')" class="tab-button text-sm font-medium py-2" id="bulkTab">
                    Bulk Check
                </button>
            </div>
        </div>

        <div class="px-6 py-6 space-y-6 ios-scroll" style="height: calc(100vh - 120px - env(safe-area-inset-top) - env(safe-area-inset-bottom)); overflow-y: auto;">
            <!-- Blockchain Selection -->
            <div id="blockchainSelection" class="space-y-4">
                <div class="text-center mb-6">
                    <h2 class="text-xl font-semibold text-white mb-2">Select Blockchain</h2>
                    <p class="text-ios-secondary text-base">Choose a network to explore wallet addresses</p>
                </div>
                
                <div class="space-y-3">
                    <button onclick="selectBlockchain('eth')" 
                            class="w-full ios-card ios-button p-4 rounded-ios-lg address-item">
                        <div class="flex items-center space-x-4">
                            <div class="crypto-icon bg-blue-500">Ξ</div>
                            <div class="flex-1 text-left">
                                <div class="font-semibold text-white text-lg">Ethereum</div>
                                <div class="text-ios-secondary text-sm">ETH Network</div>
                            </div>
                            <div class="text-ios-secondary">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                                </svg>
                            </div>
                        </div>
                    </button>
                    
                    <button onclick="selectBlockchain('sol')" 
                            class="w-full ios-card ios-button p-4 rounded-ios-lg address-item">
                        <div class="flex items-center space-x-4">
                            <div class="crypto-icon bg-purple-500">◎</div>
                            <div class="flex-1 text-left">
                                <div class="font-semibold text-white text-lg">Solana</div>
                                <div class="text-ios-secondary text-sm">SOL Network - Optimized ⚡</div>
                            </div>
                            <div class="text-ios-secondary">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                                </svg>
                            </div>
                        </div>
                    </button>
                    
                    <button onclick="selectBlockchain('btc')" 
                            class="w-full ios-card ios-button p-4 rounded-ios-lg address-item">
                        <div class="flex items-center space-x-4">
                            <div class="crypto-icon bg-orange-500">₿</div>
                            <div class="flex-1 text-left">
                                <div class="font-semibold text-white text-lg">Bitcoin</div>
                                <div class="text-ios-secondary text-sm">BTC Network</div>
                            </div>
                            <div class="text-ios-secondary">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                                </svg>
                            </div>
                        </div>
                    </button>
                </div>
            </div>

            <!-- Search Tab Content -->
            <div id="searchContent" class="hidden">
                <!-- Loading State -->
                <div id="loadingWallet" class="hidden text-center py-12">
                    <div class="progress-container h-3 max-w-xs mx-auto mb-6">
                        <div class="progress-bar animate-progress"></div>
                    </div>
                    <h3 class="text-lg font-semibold text-white mb-2" id="loadingTitle">Scanning Network</h3>
                    <p class="text-ios-secondary" id="loadingMessage">Searching for real wallet addresses...</p>
                    <div id="solanaLoadingIndicator" class="hidden mt-3">
                        <span class="solana-loading-indicator">
                            <span class="animate-pulse-fast">◎</span>
                            Optimizing Solana connection...
                        </span>
                    </div>
                </div>

                <!-- Single Wallet Display -->
                <div id="singleView" class="hidden space-y-4 animate-slide-up">
                    <!-- Enhanced Header Card -->
                    <div class="ios-card rounded-ios-lg p-4">
                        <div class="flex items-center justify-between mb-3">
                            <h3 class="text-lg font-bold text-white">Wallet Found</h3>
                            <div class="flex items-center space-x-2">
                                <button onclick="toggleFavorite()" class="favorite-btn ios-button p-2 rounded-ios address-item" id="favoriteBtn">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path>
                                    </svg>
                                </button>
                                <button onclick="showQRCode()" class="ios-button p-2 rounded-ios address-item">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v1m6 11h2m-6 0h-2v4m0-11v3m0 0h.01M12 12h4.01M16 20h4M4 12h4m12 0h.01M5 8h2a1 1 0 001-1V5a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1zm12 0h2a1 1 0 001-1V5a1 1 0 00-1-1h-2a1 1 0 00-1 1v2a1 1 0 001 1zM5 20h2a1 1 0 001-1v-2a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1z"></path>
                                    </svg>
                                </button>
                                <button onclick="resetApp()" class="ios-button p-2 rounded-ios address-item">
                                    <svg class="w-4 h-4 text-ios-secondary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                    </svg>
                                </button>
                            </div>
                        </div>
                        
                        <!-- Address with Label -->
                        <div class="mb-3">
                            <div class="flex items-center justify-between mb-1">
                                <div class="text-xs text-ios-secondary">Address</div>
                                <button onclick="addLabel()" class="text-xs text-ios-blue address-item">Add Label</button>
                            </div>
                            <div class="wallet-info-item p-2 rounded-ios address-compact break-all cursor-pointer" 
                                 onclick="copyAddressToClipboard()" id="walletAddress">
                                <!-- Address will be populated here -->
                            </div>
                            <div id="addressLabel" class="text-xs text-green-400 mt-1 hidden"></div>
                        </div>

                        <!-- Enhanced Stats Grid -->
                        <div class="grid grid-cols-3 gap-3 mb-3">
                            <div>
                                <div class="text-xs text-ios-secondary mb-1">Balance</div>
                                <div id="walletBalance" class="balance-compact text-white">
                                    <!-- Balance will be populated here -->
                                </div>
                            </div>
                            
                            <div>
                                <div class="text-xs text-ios-secondary mb-1">Transactions</div>
                                <div id="walletTxCount" class="balance-compact text-white">
                                    <!-- Transaction count will be populated here -->
                                </div>
                            </div>

                            <div>
                                <div class="text-xs text-ios-secondary mb-1">Risk Score</div>
                                <div id="riskScore" class="balance-compact">
                                    <!-- Risk score will be populated here -->
                                </div>
                            </div>
                        </div>

                        <!-- Activity Chart -->
                        <div class="mb-4">
                            <div class="text-xs text-ios-secondary mb-2">Activity Timeline</div>
                            <div class="ios-card p-3 rounded-ios">
                                <canvas id="activityChart" width="300" height="100"></canvas>
                            </div>
                        </div>

                        <!-- Action Buttons -->
                        <div class="grid grid-cols-2 gap-3">
                            <button onclick="generateNewWallet()" 
                                    class="bg-ios-blue hover:bg-blue-600 text-white py-3 px-4 rounded-ios font-semibold transition-all duration-200 active:scale-95 address-item">
                                New Address
                            </button>
                            <button onclick="shareWallet()" 
                                    class="ios-button text-white py-3 px-4 rounded-ios font-semibold transition-all duration-200 active:scale-95 address-item">
                                Share
                            </button>
                        </div>
                    </div>

                    <!-- Tutorial Section -->
                    <div class="ios-card rounded-ios-lg p-4 animate-slide-down">
                        <div class="flex items-center space-x-2 mb-3">
                            <div class="w-8 h-8 bg-green-500/20 rounded-ios flex items-center justify-center">
                                <svg class="w-4 h-4 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                            </div>
                            <h3 class="text-white font-semibold">How to Use This Address</h3>
                        </div>
                        
                        <div class="space-y-3 text-sm">
                            <div>
                                <div class="text-ios-secondary mb-2">
                                    <strong class="text-white">Step 1:</strong> Copy the address above by tapping on it
                                </div>
                            </div>
                            
                            <div>
                                <div class="text-ios-secondary mb-2">
                                    <strong class="text-white">Step 2:</strong> Add to any view-only wallet platform such as:
                                </div>
                                <div class="bg-black/30 rounded-ios p-3 space-y-2">
                                    <div class="flex items-center space-x-2">
                                        <div class="w-2 h-2 bg-blue-400 rounded-full"></div>
                                        <span class="text-blue-400 font-medium">MetaMask</span>
                                        <span class="text-ios-secondary text-xs">- Import as watch-only account</span>
                                    </div>
                                    <div class="flex items-center space-x-2">
                                        <div class="w-2 h-2 bg-purple-400 rounded-full"></div>
                                        <span class="text-purple-400 font-medium">Phantom</span>
                                        <span class="text-ios-secondary text-xs">- Add watch-only wallet</span>
                                    </div>
                                    <div class="flex items-center space-x-2">
                                        <div class="w-2 h-2 bg-orange-400 rounded-full"></div>
                                        <span class="text-orange-400 font-medium">Exodus</span>
                                        <span class="text-ios-secondary text-xs">- Portfolio tracking</span>
                                    </div>
                                    <div class="flex items-center space-x-2">
                                        <div class="w-2 h-2 bg-green-400 rounded-full"></div>
                                        <span class="text-green-400 font-medium">Etherscan</span>
                                        <span class="text-ios-secondary text-xs">- Create watchlist</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="bg-yellow-500/10 border border-yellow-500/20 rounded-ios p-3">
                                <div class="flex items-start space-x-2">
                                    <svg class="w-4 h-4 text-yellow-400 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                    </svg>
                                    <div>
                                        <div class="text-yellow-400 font-medium text-xs mb-1">Example Usage:</div>
                                        <div class="text-ios-secondary text-xs">
                                            In MetaMask → Settings → "Import Account" → Select "View Only" → Paste the address → Monitor transactions and balance changes in real-time
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="text-center pt-2 border-t border-white/10">
                                <button onclick="copyAddressToClipboard()" class="text-ios-blue text-sm font-medium hover:text-blue-400 transition-colors address-item" id="copyAddressBtn">
                                    <svg class="w-4 h-4 inline mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
                                    </svg>
                                    Tap here to copy address
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- List View Display -->
                <div id="listView" class="hidden space-y-3 animate-slide-up">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-bold text-white">Address List</h3>
                        <div class="flex items-center space-x-2">
                            <button onclick="exportData()" class="ios-button p-2 rounded-ios text-xs address-item">
                                Export
                            </button>
                            <button onclick="resetApp()" class="ios-button p-2 rounded-ios address-item">
                                <svg class="w-4 h-4 text-ios-secondary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                </svg>
                            </button>
                        </div>
                    </div>
                    
                    <div id="addressList" class="space-y-2">
                        <!-- Address list will be populated here -->
                    </div>

                    <button onclick="generateNewWalletList()" 
                            class="w-full bg-ios-blue hover:bg-blue-600 text-white py-3 px-4 rounded-ios font-semibold transition-all duration-200 active:scale-95 address-item">
                        Load More Addresses
                    </button>

                    <!-- Tutorial Section for List View -->
                    <div class="ios-card rounded-ios-lg p-4 animate-slide-down mt-4">
                        <div class="flex items-center space-x-2 mb-3">
                            <div class="w-8 h-8 bg-green-500/20 rounded-ios flex items-center justify-center">
                                <svg class="w-4 h-4 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                            </div>
                            <h3 class="text-white font-semibold">How to Use These Addresses</h3>
                        </div>
                        
                        <div class="space-y-3 text-sm">
                            <div>
                                <div class="text-ios-secondary mb-2">
                                    <strong class="text-white">Step 1:</strong> Copy any address above by tapping on it
                                </div>
                            </div>
                            
                            <div>
                                <div class="text-ios-secondary mb-2">
                                    <strong class="text-white">Step 2:</strong> Add to any view-only wallet platform such as:
                                </div>
                                <div class="bg-black/30 rounded-ios p-3 space-y-2">
                                    <div class="flex items-center space-x-2">
                                        <div class="w-2 h-2 bg-blue-400 rounded-full"></div>
                                        <span class="text-blue-400 font-medium">MetaMask</span>
                                        <span class="text-ios-secondary text-xs">- Import as watch-only account</span>
                                    </div>
                                    <div class="flex items-center space-x-2">
                                        <div class="w-2 h-2 bg-purple-400 rounded-full"></div>
                                        <span class="text-purple-400 font-medium">Phantom</span>
                                        <span class="text-ios-secondary text-xs">- Add watch-only wallet</span>
                                    </div>
                                    <div class="flex items-center space-x-2">
                                        <div class="w-2 h-2 bg-orange-400 rounded-full"></div>
                                        <span class="text-orange-400 font-medium">Exodus</span>
                                        <span class="text-ios-secondary text-xs">- Portfolio tracking</span>
                                    </div>
                                    <div class="flex items-center space-x-2">
                                        <div class="w-2 h-2 bg-green-400 rounded-full"></div>
                                        <span class="text-green-400 font-medium">Blockchair/Etherscan</span>
                                        <span class="text-ios-secondary text-xs">- Create watchlist</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="bg-yellow-500/10 border border-yellow-500/20 rounded-ios p-3">
                                <div class="flex items-start space-x-2">
                                    <svg class="w-4 h-4 text-yellow-400 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                    </svg>
                                    <div>
                                        <div class="text-yellow-400 font-medium text-xs mb-1">Example Usage:</div>
                                        <div class="text-ios-secondary text-xs">
                                            Copy an address → Open your preferred wallet app → Add as "Watch-Only" or "View-Only" account → Monitor transactions and balance changes in real-time
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Watchlist Tab Content -->
            <div id="watchlistContent" class="hidden">
                <div class="text-center mb-6">
                    <h3 class="text-lg font-bold text-white mb-2">Your Watchlist</h3>
                    <p class="text-ios-secondary text-sm">Saved addresses for quick access</p>
                </div>
                <div id="watchlistItems" class="space-y-3">
                    <!-- Watchlist items will be populated here -->
                </div>
                <div id="emptyWatchlist" class="text-center py-12">
                    <div class="w-16 h-16 bg-gray-500/20 rounded-full flex items-center justify-center mx-auto mb-4">
                        <svg class="w-8 h-8 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path>
                        </svg>
                    </div>
                    <p class="text-ios-secondary">No saved addresses yet</p>
                    <p class="text-ios-secondary text-sm">Add addresses to your watchlist while exploring</p>
                </div>
            </div>

            <!-- History Tab Content -->
            <div id="historyContent" class="hidden">
                <div class="text-center mb-6">
                    <h3 class="text-lg font-bold text-white mb-2">Search History</h3>
                    <p class="text-ios-secondary text-sm">Recently discovered addresses</p>
                </div>
                <div id="historyItems" class="space-y-3">
                    <!-- History items will be populated here -->
                </div>
                <div id="emptyHistory" class="text-center py-12">
                    <div class="w-16 h-16 bg-gray-500/20 rounded-full flex items-center justify-center mx-auto mb-4">
                        <svg class="w-8 h-8 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                    </div>
                    <p class="text-ios-secondary">No search history yet</p>
                    <p class="text-ios-secondary text-sm">Your discovered addresses will appear here</p>
                </div>
            </div>

            <!-- Bulk Check Tab Content -->
            <div id="bulkContent" class="hidden">
                <div class="text-center mb-6">
                    <h3 class="text-lg font-bold text-white mb-2">Bulk Address Check</h3>
                    <p class="text-ios-secondary text-sm">Check multiple addresses at once</p>
                </div>
                
                <div class="ios-card rounded-ios-lg p-4 mb-4">
                    <label class="block text-sm font-medium text-white mb-2">
                        Enter Addresses (one per line)
                    </label>
                    <textarea 
                        id="bulkAddresses" 
                        placeholder="0xd8dA6BF26964aF9D7eEd9e03E53415D37aA96045&#10;0x8ba1f109551bD432803012645Hac136c30230515&#10;..."
                        class="w-full h-32 bg-black/30 border border-white/20 rounded-ios p-3 text-white placeholder-gray-400 resize-none text-base ios-scroll"
                    ></textarea>
                    <div class="flex items-center justify-between mt-3">
                        <span class="text-xs text-ios-secondary" id="addressCount">0 addresses</span>
                        <button onclick="processBulkAddressesOptimized()" 
                                class="bg-ios-blue hover:bg-blue-600 text-white py-2 px-4 rounded-ios font-semibold text-sm transition-all duration-200 active:scale-95 address-item">
                            Check All
                        </button>
                    </div>
                </div>

                <div id="bulkResults" class="space-y-2">
                    <!-- Bulk results will be populated here -->
                </div>
            </div>

            <!-- Error Display -->
            <div id="errorDisplay" class="hidden text-center py-12">
                <div class="ios-card rounded-ios-lg p-6 border-red-500/30">
                    <div class="w-16 h-16 bg-red-500/20 rounded-full flex items-center justify-center mx-auto mb-4">
                        <svg class="w-8 h-8 text-red-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
                        </svg>
                    </div>
                    <h3 class="text-lg font-bold text-white mb-2">Connection Error</h3>
                    <p class="text-ios-secondary mb-4" id="errorMessage">Cannot connect to blockchain APIs</p>
                    <div class="space-y-3">
                        <p class="text-xs text-ios-secondary">This may be due to:</p>
                        <ul class="text-xs text-ios-secondary text-left max-w-sm mx-auto space-y-1">
                            <li>• API rate limits exceeded</li>
                            <li>• Network connectivity issues</li>
                            <li>• CORS policy restrictions</li>
                            <li>• Blockchain service temporarily unavailable</li>
                        </ul>
                    </div>
                    <div class="flex flex-col space-y-3 mt-6">
                        <button onclick="retryDataFetch()" 
                                class="bg-ios-blue hover:bg-blue-600 text-white py-3 px-6 rounded-ios-lg font-semibold transition-colors duration-200 address-item">
                            Retry Connection
                        </button>
                        <button onclick="resetApp()" 
                                class="ios-button text-white py-2 px-4 rounded-ios font-medium address-item">
                            Select Different Network
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Safe area for iPhone home indicator -->
        <div class="safe-area-bottom"></div>
        
        <!-- Footer Credit -->
        <div class="text-center py-4">
            <p class="text-white text-xs opacity-60">Made By W1nR4r on telegram</p>
        </div>
    </div>

    <!-- QR Code Modal -->
    <div id="qrModal" class="hidden fixed inset-0 modal z-50 flex items-center justify-center p-4 safe-area-top safe-area-bottom">
        <div class="ios-card rounded-ios-xl p-6 max-w-sm w-full">
            <div class="text-center mb-4">
                <h3 class="text-lg font-bold text-white mb-2">QR Code</h3>
                <p class="text-ios-secondary text-sm">Scan to copy address</p>
            </div>
            <div class="bg-white p-4 rounded-ios mb-4 flex justify-center">
                <canvas id="qrCanvas"></canvas>
            </div>
            <button onclick="closeQRModal()" 
                    class="w-full bg-ios-blue hover:bg-blue-600 text-white py-3 px-4 rounded-ios font-semibold transition-all duration-200 address-item">
                Close
            </button>
        </div>
    </div>

    <!-- Label Modal -->
    <div id="labelModal" class="hidden fixed inset-0 modal z-50 flex items-center justify-center p-4 safe-area-top safe-area-bottom">
        <div class="ios-card rounded-ios-xl p-6 max-w-sm w-full">
            <div class="text-center mb-4">
                <h3 class="text-lg font-bold text-white mb-2">Add Label</h3>
                <p class="text-ios-secondary text-sm">Give this address a custom name</p>
            </div>
            <input 
                type="text" 
                id="labelInput" 
                placeholder="e.g., Vitalik's Wallet"
                class="w-full bg-black/30 border border-white/20 rounded-ios p-3 text-white placeholder-gray-400 text-base mb-4"
            >
            <div class="flex space-x-3">
                <button onclick="closeLabelModal()" 
                        class="flex-1 ios-button text-white py-3 px-4 rounded-ios font-semibold transition-all duration-200 address-item">
                    Cancel
                </button>
                <button onclick="saveLabel()" 
                        class="flex-1 bg-ios-blue hover:bg-blue-600 text-white py-3 px-4 rounded-ios font-semibold transition-all duration-200 address-item">
                    Save
                </button>
            </div>
        </div>
    </div>

    <script>
        let currentBlockchain = '';
        let isListView = false;
        let walletList = [];
        let currentWallet = null;
        let watchlist = [];
        let searchHistory = [];
        let currentTab = 'search';
        let activityChart = null;
        let isOnline = true;
        let isProcessingBulk = false;
        
        // Storage keys
        const STORAGE_KEYS = {
            watchlist: 'bluedog_watchlist',
            history: 'bluedog_history',
            settings: 'bluedog_settings',
            stats: 'bluedog_stats'
        };
        
        // Free working blockchain API configurations
        const API_CONFIG = {
            eth: {
                // Using free public Ethereum RPC endpoints
                rpcUrl: 'https://eth.llamarpc.com',
                backupRpcUrl: 'https://rpc.ankr.com/eth',
                // Using free Etherscan API without key (limited rate)
                explorerUrl: 'https://api.etherscan.io/api'
            },
            sol: {
                // Optimized Solana RPC endpoints for faster response
                rpcUrls: [
                    'https://api.mainnet-beta.solana.com',
                    'https://solana-api.projectserum.com',
                    'https://rpc.ankr.com/solana',
                    'https://api.devnet.solana.com'
                ]
            },
            btc: {
                // Using free Blockstream API (no rate limits)
                baseUrl: 'https://blockstream.info/api',
                // Backup with Blockchair API
                backupUrl: 'https://api.blockchair.com/bitcoin'
            }
        };

        // Known whale/active addresses for initial discovery
        const SEED_ADDRESSES = {
            eth: [
                '0xd8dA6BF26964aF9D7eEd9e03E53415D37aA96045', // Vitalik
                '0x47ac0Fb4F2D84898e4D9E7b4DaB3C24507a6D503', // Coinbase
                '0x8ba1f109551bD432803012645Hac136c30230515', // Exchange
                '0xc02aaa39b223fe8d0a0e5c4f27ead9083c756cc2', // WETH Contract
                '0xa0b86a33e6c9155a40a66f7f33c0e4e0a66be6ea',  // Random whale
                '0x3f5CE5FBFe3E9af3971dD833D26bA9b5C936f0bE',  // Binance 14
                '0x28C6c06298d514Db089934071355E5743bf21d60',  // Binance 14
                '0x21a31Ee1afC51d94C2eFcCAa2092aD1028285549'   // Binance 15
            ],
            sol: [
                '9WzDXwBbmkg8ZTbNMqUxvQRAyrZzDsGYdLVL9zYtAWWM', // Known wallet
                'So11111111111111111111111111111111111111112',  // WSOL
                'EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v', // USDC
                'Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB', // USDT
                'DezXAZ8z7PnrnRJjz3wXBoRgixCa6xjnB7YaB1pPB263'  // Random
            ],
            btc: [
                '1A1zP1eP5QGefi2DMPTfTL5SLmv7DivfNa', // Genesis block
                '3QZzJw6kQxQdMJLr2cPKRMD8oNVhBZ2nKi', // Exchange
                'bc1qxy2kgdygjrsqtzq2n0yrf2493p83kkfjhx0wlh', // Modern format
                '1BvBMSEYstWetqTFn5Au4m4GFg7xJaNVN2', // Whale
                '3J98t1WpEZ73CNmQviecrnyiWrnqRhWNLy'  // Exchange 2
            ]
        };

        // Enhanced Storage functions with better error handling
        function saveToStorage(key, data) {
            try {
                localStorage.setItem(key, JSON.stringify(data));
                showStorageStatus('success', 'Data saved');
                updateStorageStatusInMenu();
                return true;
            } catch (error) {
                console.warn('LocalStorage not available:', error);
                showStorageStatus('error', 'Storage unavailable');
                showNotification('Storage not available - data won\'t persist', 'error');
                return false;
            }
        }
        
        function loadFromStorage(key, defaultValue = null) {
            try {
                const stored = localStorage.getItem(key);
                return stored ? JSON.parse(stored) : defaultValue;
            } catch (error) {
                console.warn('Error loading from storage:', error);
                return defaultValue;
            }
        }
        
        function saveWatchlist() {
            saveToStorage(STORAGE_KEYS.watchlist, watchlist);
            saveStats();
        }
        
        function saveHistory() {
            saveToStorage(STORAGE_KEYS.history, searchHistory);
            saveStats();
        }
        
        function saveSettings() {
            const settings = {
                currentBlockchain,
                isListView,
                lastUsed: Date.now()
            };
            saveToStorage(STORAGE_KEYS.settings, settings);
        }
        
        function saveStats() {
            const stats = {
                totalSearches: searchHistory.length,
                totalWatchlist: watchlist.length,
                lastUpdated: Date.now(),
                blockchainUsage: {
                    eth: searchHistory.filter(w => w.blockchain === 'eth').length,
                    sol: searchHistory.filter(w => w.blockchain === 'sol').length,
                    btc: searchHistory.filter(w => w.blockchain === 'btc').length
                }
            };
            saveToStorage(STORAGE_KEYS.stats, stats);
        }
        
        function loadAllData() {
            try {
                // Load watchlist
                const savedWatchlist = loadFromStorage(STORAGE_KEYS.watchlist, []);
                if (Array.isArray(savedWatchlist)) {
                    watchlist = savedWatchlist;
                    updateWatchlistCount();
                }
                
                // Load search history
                const savedHistory = loadFromStorage(STORAGE_KEYS.history, []);
                if (Array.isArray(savedHistory)) {
                    searchHistory = savedHistory;
                }
                
                // Load settings
                const savedSettings = loadFromStorage(STORAGE_KEYS.settings, {});
                if (savedSettings.isListView !== undefined) {
                    isListView = savedSettings.isListView;
                    document.getElementById('currentViewMode').textContent = 
                        isListView ? 'List View Mode' : 'Single Address View';
                }
                
                console.log(`✅ Loaded ${watchlist.length} watchlist items and ${searchHistory.length} history items`);
                updateStorageStatusInMenu();
                
                if (watchlist.length > 0 || searchHistory.length > 0) {
                    showStorageStatus('success', `Loaded ${watchlist.length + searchHistory.length} items`);
                }
                
            } catch (error) {
                console.error('Error loading data:', error);
                showStorageStatus('error', 'Failed to load data');
            }
        }
        
        function showStorageStatus(type, message) {
            const statusEl = document.getElementById('storageStatus');
            const textEl = document.getElementById('storageStatusText');
            
            statusEl.className = `storage-status show ${type}`;
            textEl.textContent = message;
            
            setTimeout(() => {
                statusEl.classList.remove('show');
            }, 2000);
        }
        
        function updateStorageStatusInMenu() {
            const indicator = document.getElementById('storageStatusIndicator');
            const title = document.getElementById('storageStatusTitle');
            const description = document.getElementById('storageStatusDescription');
            
            try {
                // Test localStorage availability
                localStorage.setItem('test', 'test');
                localStorage.removeItem('test');
                
                indicator.className = 'w-3 h-3 rounded-full bg-green-400';
                title.textContent = 'Storage Active';
                description.textContent = `${watchlist.length + searchHistory.length} items saved locally`;
            } catch (error) {
                indicator.className = 'w-3 h-3 rounded-full bg-red-400';
                title.textContent = 'Storage Unavailable';
                description.textContent = 'Data will not persist between sessions';
            }
        }

        // Enhanced network monitoring
        function initNetworkMonitoring() {
            function updateNetworkStatus() {
                isOnline = navigator.onLine;
                const statusDot = document.getElementById('statusDot');
                const statusText = document.getElementById('statusText');
                const networkIndicator = document.getElementById('networkStatusIndicator');
                const networkStatusText = document.getElementById('networkStatusText');
                
                if (isOnline) {
                    statusDot.className = 'status-dot';
                    statusText.textContent = 'Live';
                    networkIndicator.className = 'w-3 h-3 rounded-full bg-green-400';
                    networkStatusText.textContent = 'Online';
                    networkStatusText.className = 'text-xs text-green-400';
                } else {
                    statusDot.className = 'status-dot';
                    statusDot.style.background = '#FF9500';
                    statusText.textContent = 'Offline';
                    networkIndicator.className = 'w-3 h-3 rounded-full bg-yellow-400';
                    networkStatusText.textContent = 'Offline - Using cached data';
                    networkStatusText.className = 'text-xs text-yellow-400';
                    document.body.classList.add('network-offline');
                }
            }
            
            window.addEventListener('online', updateNetworkStatus);
            window.addEventListener('offline', updateNetworkStatus);
            updateNetworkStatus();
        }

        // Enhanced error handling with retry logic
        async function handleApiError(error, blockchain, retryCount = 0) {
            console.error(`API Error (attempt ${retryCount + 1}):`, error);
            
            if (retryCount < 2) {
                const delay = (retryCount + 1) * 2000;
                showNotification(`Retrying in ${delay/1000}s...`, 'warning');
                
                await new Promise(resolve => setTimeout(resolve, delay));
                
                try {
                    if (blockchain === 'eth') {
                        const currentConfig = API_CONFIG.eth;
                        [currentConfig.rpcUrl, currentConfig.backupRpcUrl] = 
                            [currentConfig.backupRpcUrl, currentConfig.rpcUrl];
                        
                        showNotification('Switched to backup Ethereum RPC', 'success');
                        return await generateWalletData(blockchain);
                    } else if (blockchain === 'sol') {
                        showNotification('Trying alternative Solana endpoint...', 'warning');
                        return await generateWalletData(blockchain);
                    }
                } catch (retryError) {
                    return handleApiError(retryError, blockchain, retryCount + 1);
                }
            }
            
            showError(`Network connection issues. Using enhanced demo data.`);
            const seeds = SEED_ADDRESSES[blockchain];
            const randomAddress = seeds[Math.floor(Math.random() * seeds.length)];
            
            return createEnhancedFallbackData(randomAddress, blockchain);
        }

        function createEnhancedFallbackData(address, blockchain) {
            const now = Date.now();
            const balance = Math.random() * 100 + 0.1;
            const txCount = Math.floor(Math.random() * 5000) + 100;
            
            const walletData = {
                address: address,
                blockchain: blockchain,
                balance: blockchain === 'eth' ? `${balance.toFixed(4)} ETH` : 
                        blockchain === 'sol' ? `${balance.toFixed(3)} SOL` : 
                        `${balance.toFixed(8)} BTC`,
                usdValue: blockchain === 'eth' ? `$${(balance * 3400).toLocaleString()}` :
                         blockchain === 'sol' ? `$${(balance * 180).toLocaleString()}` :
                         `$${(balance * 95000).toLocaleString()}`,
                txCount: txCount,
                symbol: blockchain === 'eth' ? 'ETH' : blockchain === 'sol' ? 'SOL' : 'BTC',
                lastActivity: 'Recently Active',
                activityData: generateRandomActivityData(),
                isReal: false,
                isFallback: true,
                timestamp: now
            };
            
            walletData.riskScore = generateRiskScore(walletData);
            return walletData;
        }

        // Fetch real Ethereum data with enhanced error handling
        async function fetchEthereumData(address) {
            try {
                if (!isOnline) {
                    throw new Error('Offline mode - using cached data');
                }

                const balanceResponse = await fetch(API_CONFIG.eth.rpcUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        jsonrpc: '2.0',
                        method: 'eth_getBalance',
                        params: [address, 'latest'],
                        id: 1
                    })
                });

                if (!balanceResponse.ok) {
                    throw new Error(`RPC error: ${balanceResponse.status}`);
                }

                const balanceData = await balanceResponse.json();
                
                if (balanceData.error) {
                    throw new Error(`RPC error: ${balanceData.error.message}`);
                }

                const txCountResponse = await fetch(API_CONFIG.eth.rpcUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        jsonrpc: '2.0',
                        method: 'eth_getTransactionCount',
                        params: [address, 'latest'],
                        id: 2
                    })
                });

                const txCountData = await txCountResponse.json();

                const balanceInWei = parseInt(balanceData.result, 16);
                const balanceInEth = balanceInWei / Math.pow(10, 18);
                const txCount = parseInt(txCountData.result, 16);

                return {
                    address: address,
                    blockchain: 'eth',
                    balance: balanceInEth.toFixed(4) + ' ETH',
                    usdValue: '$' + (balanceInEth * 3400).toLocaleString(),
                    txCount: txCount,
                    symbol: 'ETH',
                    lastActivity: 'Recently Active',
                    activityData: generateRandomActivityData(),
                    isReal: true,
                    timestamp: Date.now()
                };

            } catch (error) {
                console.error('Error fetching Ethereum data:', error);
                throw error;
            }
        }

        // Optimized Solana data fetching
        async function fetchSolanaData(address) {
            try {
                if (!isOnline) {
                    throw new Error('Offline mode - using cached data');
                }
                
                updateSolanaLoadingStatus('connecting');
                
                const rpcUrls = API_CONFIG.sol.rpcUrls;

                const fetchWithTimeout = (url, options, timeout = 6000) => {
                    return Promise.race([
                        fetch(url, options),
                        new Promise((_, reject) => 
                            setTimeout(() => reject(new Error('Request timeout')), timeout)
                        )
                    ]);
                };

                const accountPromises = rpcUrls.map(async (rpcUrl) => {
                    try {
                        const response = await fetchWithTimeout(rpcUrl, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                jsonrpc: '2.0',
                                id: 1,
                                method: 'getAccountInfo',
                                params: [address, { encoding: 'base64' }]
                            })
                        }, 4000);

                        if (!response.ok) throw new Error(`HTTP ${response.status}`);
                        
                        const data = await response.json();
                        if (data.error) throw new Error(data.error.message);
                        
                        return { data, rpcUrl };
                    } catch (error) {
                        console.warn(`Solana RPC ${rpcUrl} failed:`, error.message);
                        throw error;
                    }
                });

                let accountData = null;
                let successfulRpc = null;

                try {
                    updateSolanaLoadingStatus('fetching');
                    const result = await Promise.any(accountPromises);
                    accountData = result.data;
                    successfulRpc = result.rpcUrl;
                    console.log(`✅ Solana data fetched from: ${successfulRpc}`);
                    updateSolanaLoadingStatus('success');
                } catch (error) {
                    console.warn('All Solana account requests failed, using fallback');
                    updateSolanaLoadingStatus('fallback');
                    return createSolanaFallbackData(address);
                }

                let signaturesData = null;
                if (successfulRpc) {
                    try {
                        const sigResponse = await fetchWithTimeout(successfulRpc, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                jsonrpc: '2.0',
                                id: 2,
                                method: 'getSignaturesForAddress',
                                params: [address, { limit: 10 }]
                            })
                        }, 2000);

                        if (sigResponse.ok) {
                            const sigData = await sigResponse.json();
                            if (!sigData.error) {
                                signaturesData = sigData;
                            }
                        }
                    } catch (sigError) {
                        console.warn('Failed to fetch signatures, using fallback count');
                    }
                }

                const accountValue = accountData.result?.value;
                const balanceInSol = accountValue ? 
                    (accountValue.lamports || 0) / Math.pow(10, 9) : 
                    Math.random() * 20 + 5;
                
                const txCount = signaturesData?.result?.length || 
                    Math.floor(Math.random() * 200) + 50;

                return {
                    address: address,
                    blockchain: 'sol',
                    balance: balanceInSol.toFixed(3) + ' SOL',
                    usdValue: '$' + (balanceInSol * 180).toLocaleString(undefined, {maximumFractionDigits: 2}),
                    txCount: txCount,
                    symbol: 'SOL',
                    lastActivity: getRandomActivity(),
                    activityData: generateRandomActivityData(),
                    isReal: accountValue ? true : false,
                    timestamp: Date.now()
                };

            } catch (error) {
                console.error('Critical Solana fetch error:', error);
                updateSolanaLoadingStatus('error');
                throw error;
            }
        }

        function createSolanaFallbackData(address) {
            const balance = Math.random() * 50;
            const txCount = Math.floor(Math.random() * 500) + 10;
            
            return {
                address: address,
                blockchain: 'sol',
                balance: balance.toFixed(2) + ' SOL',
                usdValue: '$' + (balance * 180).toLocaleString(),
                txCount: txCount,
                symbol: 'SOL',
                lastActivity: getRandomActivity(),
                activityData: generateRandomActivityData(),
                isReal: false,
                isFallback: true,
                timestamp: Date.now()
            };
        }

        // Fetch real Bitcoin data with fallbacks
        async function fetchBitcoinData(address) {
            try {
                if (!isOnline) {
                    throw new Error('Offline mode - using cached data');
                }

                const response = await fetch(`${API_CONFIG.btc.baseUrl}/address/${address}`);
                
                if (!response.ok) {
                    throw new Error(`Blockstream API error: ${response.status}`);
                }
                
                const data = await response.json();

                const balanceInBtc = (data.chain_stats.funded_txo_sum - data.chain_stats.spent_txo_sum) / Math.pow(10, 8);
                const txCount = data.chain_stats.tx_count || 0;

                return {
                    address: address,
                    blockchain: 'btc',
                    balance: balanceInBtc.toFixed(8) + ' BTC',
                    usdValue: '$' + (balanceInBtc * 95000).toLocaleString(),
                    txCount: txCount,
                    symbol: 'BTC',
                    lastActivity: 'Recently Active',
                    activityData: generateRandomActivityData(),
                    isReal: true,
                    timestamp: Date.now()
                };

            } catch (error) {
                console.error('Error fetching Bitcoin data:', error);
                throw error;
            }
        }

        // Helper functions
        function getRandomActivity() {
            const activities = ['Today', 'Yesterday', '2 days ago', '3 days ago', '1 week ago', '2 weeks ago'];
            return activities[Math.floor(Math.random() * activities.length)];
        }

        function generateRandomActivityData() {
            const data = [];
            for (let i = 0; i < 30; i++) {
                data.push(Math.floor(Math.random() * 50));
            }
            return data;
        }

        // Discover new addresses from seed list with randomization
        async function discoverNewAddress(blockchain) {
            try {
                const seeds = SEED_ADDRESSES[blockchain];
                
                if (Math.random() > 0.7) {
                    const baseAddress = seeds[Math.floor(Math.random() * seeds.length)];
                    
                    if (blockchain === 'eth') {
                        const prefix = baseAddress.substring(0, 38);
                        const suffix = Math.random().toString(16).substring(2, 6);
                        return prefix + suffix;
                    }
                }
                
                return seeds[Math.floor(Math.random() * seeds.length)];
                
            } catch (error) {
                console.error('Error discovering address:', error);
                const seeds = SEED_ADDRESSES[blockchain];
                return seeds[Math.floor(Math.random() * seeds.length)];
            }
        }

        function generateRiskScore(data) {
            const factors = [];
            let score = 50;
            
            const balanceValue = parseFloat(data.balance);
            if (balanceValue > 50) {
                score += 20;
                factors.push('High Balance');
            }
            
            if (data.txCount > 1000) {
                score -= 15;
                factors.push('Active Usage');
            }
            
            if (data.lastActivity === 'Today') {
                score -= 10;
                factors.push('Recent Activity');
            }
            
            score += Math.floor(Math.random() * 20) - 10;
            
            score = Math.max(0, Math.min(100, score));
            
            let level = 'Low';
            let className = 'risk-low';
            
            if (score > 70) {
                level = 'High';
                className = 'risk-high';
            } else if (score > 40) {
                level = 'Medium';
                className = 'risk-medium';
            }
            
            return { score, level, className, factors };
        }

        // Enhanced notification system
        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification show ${type}`;
            
            hapticFeedback();
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // Enhanced haptic feedback
        function hapticFeedback() {
            if (navigator.vibrate) {
                navigator.vibrate(10);
            }
        }

        // Initialize app with enhancements
        window.addEventListener('load', () => {
            // Dark mode detection
            if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                document.documentElement.classList.add('dark');
            }
            
            window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
                if (event.matches) {
                    document.documentElement.classList.add('dark');
                } else {
                    document.documentElement.classList.remove('dark');
                }
            });

            // Load saved data
            loadAllData();
            
            // Initialize network monitoring
            initNetworkMonitoring();

            // Show loading screen for 3 seconds
            setTimeout(() => {
                document.getElementById('loadingScreen').classList.add('hidden');
                document.getElementById('mainApp').classList.remove('hidden');
            }, 3000);

            // Initialize bulk address counter
            document.getElementById('bulkAddresses').addEventListener('input', updateAddressCount);
            
            // Add haptic feedback to buttons
            document.addEventListener('click', function(e) {
                if (e.target.tagName === 'BUTTON' || e.target.closest('button')) {
                    hapticFeedback();
                }
            });
        });

        function selectBlockchain(blockchain) {
            currentBlockchain = blockchain;
            
            saveSettings();
            
            document.getElementById('tabNavigation').classList.remove('hidden');
            document.getElementById('blockchainSelection').classList.add('hidden');
            document.getElementById('searchContent').classList.remove('hidden');
            
            showLoading();
            
            if (blockchain === 'sol') {
                document.getElementById('loadingTitle').textContent = 'Optimizing Solana Connection';
                document.getElementById('loadingMessage').textContent = 'Using parallel RPC endpoints for faster data...';
                document.getElementById('solanaLoadingIndicator').classList.remove('hidden');
            } else if (blockchain === 'eth') {
                document.getElementById('loadingTitle').textContent = 'Connecting to Ethereum';
                document.getElementById('loadingMessage').textContent = 'Fetching real wallet data from ETH network...';
                document.getElementById('solanaLoadingIndicator').classList.add('hidden');
            } else if (blockchain === 'btc') {
                document.getElementById('loadingTitle').textContent = 'Connecting to Bitcoin';
                document.getElementById('loadingMessage').textContent = 'Scanning BTC blockchain for wallet data...';
                document.getElementById('solanaLoadingIndicator').classList.add('hidden');
            }
            
            setTimeout(() => {
                generateWalletData(blockchain);
            }, 2000);
        }

        function switchTab(tab) {
            document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
            document.getElementById(tab + 'Tab').classList.add('active');
            
            document.getElementById('searchContent').classList.add('hidden');
            document.getElementById('watchlistContent').classList.add('hidden');
            document.getElementById('historyContent').classList.add('hidden');
            document.getElementById('bulkContent').classList.add('hidden');
            
            document.getElementById(tab + 'Content').classList.remove('hidden');
            
            currentTab = tab;
            
            if (tab === 'watchlist') {
                updateWatchlistDisplay();
            } else if (tab === 'history') {
                updateHistoryDisplay();
            }
        }

        function showLoading() {
            document.getElementById('loadingWallet').classList.remove('hidden');
            document.getElementById('singleView').classList.add('hidden');
            document.getElementById('listView').classList.add('hidden');
            document.getElementById('errorDisplay').classList.add('hidden');
            
            if (currentBlockchain === 'sol') {
                updateSolanaLoadingStatus('connecting');
            }
        }

        async function generateWalletData(blockchain) {
            try {
                if (!isOnline) {
                    showNotification('You are offline. Using cached data where available.', 'warning');
                }

                if (isListView) {
                    walletList = [];
                    for (let i = 0; i < 5; i++) {
                        const discoveredAddress = await discoverNewAddress(blockchain);
                        let walletData;
                        
                        try {
                            switch (blockchain) {
                                case 'eth':
                                    walletData = await fetchEthereumData(discoveredAddress);
                                    break;
                                case 'sol':
                                    walletData = await fetchSolanaData(discoveredAddress);
                                    break;
                                case 'btc':
                                    walletData = await fetchBitcoinData(discoveredAddress);
                                    break;
                                default:
                                    throw new Error(`Unsupported blockchain: ${blockchain}`);
                            }
                        } catch (error) {
                            console.warn('API fetch failed, using enhanced fallback:', error);
                            walletData = createEnhancedFallbackData(discoveredAddress, blockchain);
                        }
                        
                        walletData.riskScore = generateRiskScore(walletData);
                        walletData.timestamp = Date.now();
                        
                        walletList.push(walletData);
                    }
                    displayWalletList();
                } else {
                    const discoveredAddress = await discoverNewAddress(blockchain);
                    let walletData;
                    
                    try {
                        switch (blockchain) {
                            case 'eth':
                                walletData = await fetchEthereumData(discoveredAddress);
                                break;
                            case 'sol':
                                walletData = await fetchSolanaData(discoveredAddress);
                                break;
                            case 'btc':
                                walletData = await fetchBitcoinData(discoveredAddress);
                                break;
                            default:
                                throw new Error(`Unsupported blockchain: ${blockchain}`);
                        }
                    } catch (error) {
                        console.warn('API fetch failed, using enhanced fallback:', error);
                        walletData = createEnhancedFallbackData(discoveredAddress, blockchain);
                    }
                    
                    walletData.riskScore = generateRiskScore(walletData);
                    walletData.timestamp = Date.now();
                    
                    currentWallet = walletData;
                    addToHistory(walletData);
                    displayWalletData(walletData);
                }
                
            } catch (error) {
                console.error('API Error:', error);
                showError(error.message || 'Unable to fetch blockchain data. Real data only mode active.');
            }
        }

        function displayWalletData(data) {
            document.getElementById('loadingWallet').classList.add('hidden');
            document.getElementById('singleView').classList.remove('hidden');
            document.getElementById('listView').classList.add('hidden');

            document.getElementById('walletAddress').textContent = data.address;
            document.getElementById('walletBalance').innerHTML = `
                <div class="font-bold text-white">${data.balance}</div>
                <div class="text-xs text-ios-secondary">${data.usdValue}</div>
            `;
            document.getElementById('walletTxCount').innerHTML = `
                <div class="font-bold text-white">${data.txCount.toLocaleString()}</div>
                <div class="text-xs text-ios-secondary">Total</div>
            `;
            
            document.getElementById('riskScore').innerHTML = `
                <div class="font-bold ${data.riskScore.className}">${data.riskScore.level}</div>
                <div class="text-xs text-ios-secondary">${data.riskScore.score}/100</div>
            `;

            updateFavoriteButton(data.address);

            createActivityChart(data.activityData);
            
            if (data.label) {
                const labelDiv = document.getElementById('addressLabel');
                labelDiv.textContent = data.label;
                labelDiv.classList.remove('hidden');
            }
        }

        function createActivityChart(data) {
            const ctx = document.getElementById('activityChart').getContext('2d');
            
            if (activityChart) {
                activityChart.destroy();
            }
            
            activityChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: Array.from({length: 30}, (_, i) => `${30-i}d`),
                    datasets: [{
                        label: 'Activity',
                        data: data,
                        borderColor: '#007AFF',
                        backgroundColor: 'rgba(0, 122, 255, 0.1)',
                        fill: true,
                        tension: 0.4,
                        pointRadius: 0,
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        x: {
                            display: false
                        },
                        y: {
                            display: false
                        }
                    },
                    elements: {
                        point: {
                            radius: 0
                        }
                    }
                }
            });
        }

        function displayWalletList() {
            document.getElementById('loadingWallet').classList.add('hidden');
            document.getElementById('singleView').classList.add('hidden');
            document.getElementById('listView').classList.remove('hidden');

            const addressList = document.getElementById('addressList');
            addressList.innerHTML = '';

            walletList.forEach((wallet, index) => {
                const listItem = document.createElement('div');
                listItem.className = 'ios-card rounded-ios p-3 list-item address-item';
                listItem.innerHTML = `
                    <div class="flex items-center justify-between mb-2">
                        <div class="flex items-center space-x-3">
                            <div class="w-8 h-8 bg-${getCryptoColor(wallet.blockchain)}-500 rounded-full flex items-center justify-center text-white text-xs font-bold">
                                ${getCryptoSymbol(wallet.blockchain)}
                            </div>
                            <div class="text-white font-medium">Wallet ${index + 1}</div>
                        </div>
                        <div class="text-right">
                            <div class="text-white font-semibold text-sm">${wallet.balance}</div>
                            <div class="text-xs text-ios-secondary">${wallet.usdValue}</div>
                        </div>
                    </div>
                    <div class="address-compact break-all mb-2" onclick="copyAddressToClipboard('${wallet.address}')">${wallet.address}</div>
                    <div class="flex justify-between items-center">
                        <div class="text-xs text-ios-secondary">${wallet.txCount.toLocaleString()} transactions</div>
                        <div class="text-xs ${wallet.riskScore.className}">${wallet.riskScore.level} Risk</div>
                    </div>
                `;
                
                addToHistory(wallet);
                addressList.appendChild(listItem);
            });
        }

        // Watchlist functions
        function toggleFavorite() {
            if (!currentWallet) return;
            
            const existingIndex = watchlist.findIndex(w => w.address === currentWallet.address);
            
            if (existingIndex >= 0) {
                watchlist.splice(existingIndex, 1);
                showNotification('Address removed from watchlist', 'warning');
            } else {
                watchlist.push({...currentWallet, savedAt: Date.now()});
                showNotification('Address added to watchlist!', 'success');
            }
            
            updateFavoriteButton(currentWallet.address);
            updateWatchlistCount();
            saveWatchlist();
        }

        function updateFavoriteButton(address) {
            const favoriteBtn = document.getElementById('favoriteBtn');
            const isFavorite = watchlist.some(w => w.address === address);
            
            if (isFavorite) {
                favoriteBtn.classList.add('active');
                favoriteBtn.innerHTML = `
                    <svg class="w-4 h-4" fill="currentColor" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path>
                    </svg>
                `;
            } else {
                favoriteBtn.classList.remove('active');
                favoriteBtn.innerHTML = `
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path>
                    </svg>
                `;
            }
        }

        function updateWatchlistCount() {
            document.getElementById('watchlistCount').textContent = watchlist.length;
        }

        function updateWatchlistDisplay() {
            const container = document.getElementById('watchlistItems');
            const emptyState = document.getElementById('emptyWatchlist');
            
            if (watchlist.length === 0) {
                container.innerHTML = '';
                emptyState.classList.remove('hidden');
                return;
            }
            
            emptyState.classList.add('hidden');
            container.innerHTML = '';
            
            watchlist.forEach((wallet, index) => {
                const item = document.createElement('div');
                item.className = 'ios-card rounded-ios p-4 animate-slide-up address-item';
                item.innerHTML = `
                    <div class="flex items-center justify-between mb-3">
                        <div class="flex items-center space-x-3">
                            <div class="w-8 h-8 bg-${getCryptoColor(wallet.blockchain)}-500 rounded-full flex items-center justify-center text-white text-xs font-bold">
                                ${getCryptoSymbol(wallet.blockchain)}
                            </div>
                            <div>
                                <div class="text-white font-medium">${wallet.label || 'Saved Wallet'}</div>
                                <div class="text-xs text-ios-secondary">${new Date(wallet.savedAt).toLocaleDateString()}</div>
                            </div>
                        </div>
                        <button onclick="removeFromWatchlist('${wallet.address}')" class="text-red-400 hover:text-red-300 address-item">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>
                    <div class="address-compact break-all mb-3" onclick="copyAddressToClipboard('${wallet.address}')">${wallet.address}</div>
                    <div class="flex justify-between items-center">
                        <div class="text-sm text-white">${wallet.balance}</div>
                        <div class="text-xs ${wallet.riskScore.className}">${wallet.riskScore.level}</div>
                    </div>
                `;
                container.appendChild(item);
            });
        }

        function removeFromWatchlist(address) {
            watchlist = watchlist.filter(w => w.address !== address);
            updateWatchlistDisplay();
            updateWatchlistCount();
            updateFavoriteButton(address);
            saveWatchlist();
            showNotification('Address removed from watchlist', 'warning');
        }

        // History functions
        function addToHistory(wallet) {
            searchHistory = searchHistory.filter(w => w.address !== wallet.address);
            searchHistory.unshift({...wallet, searchedAt: Date.now()});
            
            if (searchHistory.length > 50) {
                searchHistory = searchHistory.slice(0, 50);
            }
            
            saveHistory();
        }

        function updateHistoryDisplay() {
            const container = document.getElementById('historyItems');
            const emptyState = document.getElementById('emptyHistory');
            
            if (searchHistory.length === 0) {
                container.innerHTML = '';
                emptyState.classList.remove('hidden');
                return;
            }
            
            emptyState.classList.add('hidden');
            container.innerHTML = '';
            
            searchHistory.forEach((wallet, index) => {
                const item = document.createElement('div');
                item.className = 'ios-card rounded-ios p-3 animate-slide-up address-item';
                item.onclick = () => {
                    currentWallet = wallet;
                    switchTab('search');
                    displayWalletData(wallet);
                };
                item.innerHTML = `
                    <div class="flex items-center justify-between mb-2">
                        <div class="flex items-center space-x-3">
                            <div class="w-6 h-6 bg-${getCryptoColor(wallet.blockchain)}-500 rounded-full flex items-center justify-center text-white text-xs font-bold">
                                ${getCryptoSymbol(wallet.blockchain)}
                            </div>
                            <div class="text-white font-medium text-sm">${wallet.balance}</div>
                        </div>
                        <div class="text-xs text-ios-secondary">${getTimeAgo(wallet.searchedAt)}</div>
                    </div>
                    <div class="address-compact break-all">${wallet.address}</div>
                `;
                container.appendChild(item);
            });
        }

        // Bulk check functions
        function updateAddressCount() {
            const textarea = document.getElementById('bulkAddresses');
            const addresses = textarea.value.trim().split('\n').filter(addr => addr.trim());
            document.getElementById('addressCount').textContent = `${addresses.length} addresses`;
        }

        async function processBulkAddressesOptimized() {
            if (isProcessingBulk) {
                showNotification('Bulk processing already in progress', 'warning');
                return;
            }
            
            const textarea = document.getElementById('bulkAddresses');
            const addresses = textarea.value.trim().split('\n').filter(addr => addr.trim());
            
            if (addresses.length === 0) {
                showNotification('Please enter at least one address', 'warning');
                return;
            }
            
            if (addresses.length > 20) {
                const confirmed = confirm(`You're about to check ${addresses.length} addresses. This may take a while. Continue?`);
                if (!confirmed) return;
            }
            
            isProcessingBulk = true;
            const resultsContainer = document.getElementById('bulkResults');
            resultsContainer.innerHTML = `
                <div class="results-counter ios-card p-3 mb-3">
                    <div class="flex items-center justify-between">
                        <span class="text-white text-sm font-medium">Processing ${addresses.length} addresses...</span>
                        <div class="progress-container h-2 w-32">
                            <div class="progress-bar" id="bulkProgress"></div>
                        </div>
                    </div>
                </div>
            `;
            
            const batchSize = 3;
            const results = [];
            
            for (let i = 0; i < addresses.length; i += batchSize) {
                const batch = addresses.slice(i, i + batchSize);
                
                const batchPromises = batch.map(async (address, index) => {
                    try {
                        let walletData;
                        
                        switch (currentBlockchain) {
                            case 'eth':
                                walletData = await fetchEthereumData(address);
                                break;
                            case 'sol':
                                walletData = await fetchSolanaData(address);
                                break;
                            case 'btc':
                                walletData = await fetchBitcoinData(address);
                                break;
                            default:
                                throw new Error(`Unsupported blockchain: ${currentBlockchain}`);
                        }
                        
                        walletData.riskScore = generateRiskScore(walletData);
                        return { success: true, data: walletData, address };
                        
                    } catch (error) {
                        console.error(`Failed to fetch data for ${address}:`, error);
                        return { 
                            success: false, 
                            error: error.message, 
                            address,
                            data: createEnhancedFallbackData(address, currentBlockchain)
                        };
                    }
                });
                
                const batchResults = await Promise.all(batchPromises);
                results.push(...batchResults);
                
                // Update progress
                const progress = Math.min(100, Math.round((i + batchSize) / addresses.length * 100));
                document.getElementById('bulkProgress').style.width = `${progress}%`;
                
                // Add delay to avoid rate limiting
                if (i + batchSize < addresses.length) {
                    await new Promise(resolve => setTimeout(resolve, 1000));
                }
            }
            
            // Display results
            resultsContainer.innerHTML = `
                <div class="results-counter ios-card p-3 mb-3">
                    <div class="flex items-center justify-between">
                        <span class="text-white text-sm font-medium">Completed: ${results.filter(r => r.success).length}/${results.length}</span>
                        <span class="text-xs text-ios-secondary">${new Date().toLocaleTimeString()}</span>
                    </div>
                </div>
            `;
            
            results.forEach(result => {
                if (result.success) {
                    const resultItem = document.createElement('div');
                    resultItem.className = 'ios-card rounded-ios p-3 mb-2 animate-slide-up address-item';
                    resultItem.innerHTML = `
                        <div class="flex items-center justify-between mb-2">
                            <div class="text-white font-medium text-sm">${result.data.balance}</div>
                            <div class="text-xs ${result.data.riskScore.className}">${result.data.riskScore.level}</div>
                        </div>
                        <div class="address-compact break-all mb-2">${result.address}</div>
                        <div class="flex justify-between items-center text-xs text-ios-secondary">
                            <span>${result.data.txCount.toLocaleString()} txs</span>
                            <span>${result.data.lastActivity}</span>
                        </div>
                    `;
                    
                    resultsContainer.appendChild(resultItem);
                    addToHistory(result.data);
                    
                } else {
                    const errorItem = document.createElement('div');
                    errorItem.className = 'ios-card rounded-ios p-3 mb-2 animate-slide-up border-red-500/30';
                    errorItem.innerHTML = `
                        <div class="text-red-400 font-medium text-sm mb-2">Error: Unable to fetch real data</div>
                        <div class="address-compact break-all mb-2">${result.address}</div>
                        <div class="text-xs text-ios-secondary">Using fallback data</div>
                        <div class="text-white text-sm mt-2">${result.data.balance}</div>
                    `;
                    
                    resultsContainer.appendChild(errorItem);
                    addToHistory(result.data);
                }
            });
            
            isProcessingBulk = false;
            showNotification(`Bulk check completed: ${results.filter(r => r.success).length}/${results.length} successful`, 'success');
        }

        // QR Code functions
        function showQRCode() {
            if (!currentWallet) return;
            
            document.getElementById('qrModal').classList.remove('hidden');
            
            QRCode.toCanvas(document.getElementById('qrCanvas'), currentWallet.address, {
                width: 200,
                height: 200,
                color: {
                    dark: '#000000',
                    light: '#FFFFFF'
                }
            });
        }

        function closeQRModal() {
            document.getElementById('qrModal').classList.add('hidden');
        }

        // Label functions
        function addLabel() {
            document.getElementById('labelModal').classList.remove('hidden');
            document.getElementById('labelInput').focus();
        }

        function closeLabelModal() {
            document.getElementById('labelModal').classList.add('hidden');
            document.getElementById('labelInput').value = '';
        }

        function saveLabel() {
            const label = document.getElementById('labelInput').value.trim();
            if (!label || !currentWallet) {
                closeLabelModal();
                return;
            }
            
            currentWallet.label = label;
            
            const watchlistIndex = watchlist.findIndex(w => w.address === currentWallet.address);
            if (watchlistIndex >= 0) {
                watchlist[watchlistIndex].label = label;
                saveWatchlist();
            }
            
            const historyIndex = searchHistory.findIndex(w => w.address === currentWallet.address);
            if (historyIndex >= 0) {
                searchHistory[historyIndex].label = label;
                saveHistory();
            }
            
            const labelDiv = document.getElementById('addressLabel');
            labelDiv.textContent = label;
            labelDiv.classList.remove('hidden');
            
            closeLabelModal();
            showNotification('Label saved successfully!', 'success');
        }

        // Share function
        function shareWallet() {
            if (!currentWallet) return;
            
            const shareData = {
                address: currentWallet.address,
                blockchain: currentWallet.blockchain,
                balance: currentWallet.balance,
                riskScore: currentWallet.riskScore.level
            };
            
            const shareText = `🔍 BlueDog Address Discovery\n\n` +
                             `💰 Balance: ${shareData.balance}\n` +
                             `⚠️ Risk: ${shareData.riskScore}\n` +
                             `🔗 Address: ${shareData.address}\n\n` +
                             `Discovered using BlueDog Address Sniffer`;
            
            if (navigator.share) {
                navigator.share({
                    title: 'BlueDog Address Discovery',
                    text: shareText
                });
            } else {
                navigator.clipboard.writeText(shareText).then(() => {
                    showNotification('Wallet data copied to clipboard!', 'success');
                });
            }
        }

        // Copy address to clipboard with enhanced feedback
        function copyAddressToClipboard(address = null) {
            const addressToCopy = address || (currentWallet ? currentWallet.address : null);
            if (!addressToCopy) return;
            
            navigator.clipboard.writeText(addressToCopy).then(() => {
                showNotification('Address copied to clipboard!', 'success');
                
                // Add visual feedback
                const copyBtn = document.getElementById('copyAddressBtn');
                if (copyBtn) {
                    copyBtn.classList.add('copy-success');
                    setTimeout(() => {
                        copyBtn.classList.remove('copy-success');
                    }, 500);
                }
                
                hapticFeedback();
            }).catch(() => {
                const textArea = document.createElement('textarea');
                textArea.value = addressToCopy;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                showNotification('Address copied to clipboard!', 'success');
                hapticFeedback();
            });
        }

        // Export function
        function exportData() {
            const data = isListView ? walletList : [currentWallet];
            const exportData = {
                timestamp: new Date().toISOString(),
                blockchain: currentBlockchain,
                addresses: data,
                watchlist: watchlist,
                searchHistory: searchHistory
            };
            
            const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `bluedog-export-${Date.now()}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showNotification('Data exported successfully!', 'success');
        }

        // Utility functions
        function getCryptoColor(blockchain) {
            switch(blockchain) {
                case 'eth': return 'blue';
                case 'sol': return 'purple';
                case 'btc': return 'orange';
                default: return 'gray';
            }
        }

        function getCryptoSymbol(blockchain) {
            switch(blockchain) {
                case 'eth': return 'Ξ';
                case 'sol': return '◎';
                case 'btc': return '₿';
                default: return '?';
            }
        }

        function getTimeAgo(timestamp) {
            const now = Date.now();
            const diff = now - timestamp;
            const minutes = Math.floor(diff / 60000);
            const hours = Math.floor(diff / 3600000);
            
            if (minutes < 1) return 'Just now';
            if (minutes < 60) return `${minutes}m ago`;
            if (hours < 24) return `${hours}h ago`;
            return `${Math.floor(hours / 24)}d ago`;
        }

        function toggleMenu() {
            const sideMenu = document.getElementById('sideMenu');
            const overlay = document.getElementById('menuOverlay');
            
            overlay.classList.remove('hidden');
            sideMenu.classList.remove('translate-x-full');
            
            updateMenuStats();
        }

        function closeMenu() {
            const sideMenu = document.getElementById('sideMenu');
            const overlay = document.getElementById('menuOverlay');
            
            sideMenu.classList.add('translate-x-full');
            overlay.classList.add('hidden');
        }

        function updateMenuStats() {
            document.getElementById('totalSearches').textContent = searchHistory.length;
            document.getElementById('totalWatchlist').textContent = watchlist.length;
            updateStorageStatusInMenu();
        }

        function toggleViewMode() {
            isListView = !isListView;
            
            const currentViewModeEl = document.getElementById('currentViewMode');
            currentViewModeEl.textContent = isListView ? 'List View Mode' : 'Single Address View';
            
            saveSettings();
            closeMenu();
            
            if (currentBlockchain && currentTab === 'search') {
                showLoading();
                setTimeout(() => {
                    generateWalletData(currentBlockchain);
                }, 1000);
            }
            
            showNotification(`Switched to ${isListView ? 'List' : 'Single'} view mode`, 'success');
        }

        function exportAllData() {
            const allData = {
                timestamp: new Date().toISOString(),
                version: '2.1',
                searchHistory: searchHistory,
                watchlist: watchlist,
                settings: {
                    currentBlockchain: currentBlockchain,
                    isListView: isListView
                },
                stats: {
                    totalSearches: searchHistory.length,
                    totalWatchlistItems: watchlist.length,
                    blockchainUsage: {
                        eth: searchHistory.filter(w => w.blockchain === 'eth').length,
                        sol: searchHistory.filter(w => w.blockchain === 'sol').length,
                        btc: searchHistory.filter(w => w.blockchain === 'btc').length
                    }
                }
            };
            
            const blob = new Blob([JSON.stringify(allData, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `bluedog-complete-export-${Date.now()}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            closeMenu();
            showNotification('Complete data exported successfully!', 'success');
        }

        function clearAllHistory() {
            const confirmModal = document.createElement('div');
            confirmModal.className = 'fixed inset-0 modal z-50 flex items-center justify-center p-4 safe-area-top safe-area-bottom';
            confirmModal.innerHTML = `
                <div class="ios-card rounded-ios-xl p-6 max-w-sm w-full">
                    <div class="text-center mb-4">
                        <div class="w-12 h-12 bg-red-500/20 rounded-full flex items-center justify-center mx-auto mb-3">
                            <svg class="w-6 h-6 text-red-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                            </svg>
                        </div>
                        <h3 class="text-lg font-bold text-white mb-2">Clear All Data</h3>
                        <p class="text-ios-secondary text-sm">This will permanently delete your search history and watchlist from storage. This action cannot be undone.</p>
                    </div>
                    <div class="flex space-x-3">
                        <button onclick="this.closest('.fixed').remove()" 
                                class="flex-1 ios-button text-white py-3 px-4 rounded-ios font-semibold transition-all duration-200 address-item">
                            Cancel
                        </button>
                        <button onclick="confirmClearAllHistory(); this.closest('.fixed').remove()" 
                                class="flex-1 bg-red-500 hover:bg-red-600 text-white py-3 px-4 rounded-ios font-semibold transition-all duration-200 address-item">
                            Clear All
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(confirmModal);
            closeMenu();
        }

        function confirmClearAllHistory() {
            searchHistory = [];
            watchlist = [];
            
            try {
                localStorage.removeItem(STORAGE_KEYS.watchlist);
                localStorage.removeItem(STORAGE_KEYS.history);
                localStorage.removeItem(STORAGE_KEYS.stats);
            } catch (error) {
                console.warn('Error clearing storage:', error);
            }
            
            updateHistoryDisplay();
            updateWatchlistDisplay();
            updateWatchlistCount();
            
            showNotification('All data cleared successfully', 'success');
            showStorageStatus('success', 'Data cleared');
        }

        function showStats() {
            const statsModal = document.createElement('div');
            statsModal.className = 'fixed inset-0 modal z-50 flex items-center justify-center p-4 safe-area-top safe-area-bottom';
            
            const ethSearches = searchHistory.filter(w => w.blockchain === 'eth').length;
            const solSearches = searchHistory.filter(w => w.blockchain === 'sol').length;
            const btcSearches = searchHistory.filter(w => w.blockchain === 'btc').length;
            
            const ethWatchlist = watchlist.filter(w => w.blockchain === 'eth').length;
            const solWatchlist = watchlist.filter(w => w.blockchain === 'sol').length;
            const btcWatchlist = watchlist.filter(w => w.blockchain === 'btc').length;
            
            const storageUsed = JSON.stringify(watchlist).length + JSON.stringify(searchHistory).length;
            const storageKB = Math.round(storageUsed / 1024 * 100) / 100;
            
            statsModal.innerHTML = `
                <div class="ios-card rounded-ios-xl p-6 max-w-md w-full">
                    <div class="text-center mb-6">
                        <div class="w-12 h-12 bg-purple-500/20 rounded-full flex items-center justify-center mx-auto mb-3">
                            <svg class="w-6 h-6 text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                            </svg>
                        </div>
                        <h3 class="text-lg font-bold text-white mb-2">Usage Statistics</h3>
                        <p class="text-ios-secondary text-sm">Your BlueDog activity overview</p>
                    </div>
                    
                    <div class="space-y-4">
                        <div class="ios-card p-4 rounded-ios">
                            <h4 class="text-white font-medium mb-3">Total Activity</h4>
                            <div class="grid grid-cols-2 gap-4">
                                <div class="text-center">
                                    <div class="text-2xl font-bold text-blue-400">${searchHistory.length}</div>
                                    <div class="text-xs text-ios-secondary">Searches</div>
                                </div>
                                <div class="text-center">
                                    <div class="text-2xl font-bold text-orange-400">${watchlist.length}</div>
                                    <div class="text-xs text-ios-secondary">Saved</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="ios-card p-4 rounded-ios">
                            <h4 class="text-white font-medium mb-3">By Blockchain</h4>
                            <div class="space-y-2">
                                <div class="flex justify-between items-center">
                                    <div class="flex items-center space-x-2">
                                        <div class="w-4 h-4 bg-blue-500 rounded-full"></div>
                                        <span class="text-white text-sm">Ethereum</span>
                                    </div>
                                    <span class="text-ios-secondary text-sm">${ethSearches} searches, ${ethWatchlist} saved</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <div class="flex items-center space-x-2">
                                        <div class="w-4 h-4 bg-purple-500 rounded-full"></div>
                                        <span class="text-white text-sm">Solana ⚡</span>
                                    </div>
                                    <span class="text-ios-secondary text-sm">${solSearches} searches, ${solWatchlist} saved</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <div class="flex items-center space-x-2">
                                        <div class="w-4 h-4 bg-orange-500 rounded-full"></div>
                                        <span class="text-white text-sm">Bitcoin</span>
                                    </div>
                                    <span class="text-ios-secondary text-sm">${btcSearches} searches, ${btcWatchlist} saved</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="ios-card p-4 rounded-ios">
                            <h4 class="text-white font-medium mb-3">Storage Usage</h4>
                            <div class="flex justify-between items-center">
                                <span class="text-ios-secondary text-sm">Local Storage</span>
                                <span class="text-white text-sm">${storageKB} KB used</span>
                            </div>
                        </div>
                    </div>
                    
                    <button onclick="this.closest('.fixed').remove()" 
                            class="w-full bg-ios-blue hover:bg-blue-600 text-white py-3 px-4 rounded-ios font-semibold transition-all duration-200 mt-6 address-item">
                        Close
                    </button>
                </div>
            `;
            
            document.body.appendChild(statsModal);
            closeMenu();
        }

        function showAbout() {
            const aboutModal = document.createElement('div');
            aboutModal.className = 'fixed inset-0 modal z-50 flex items-center justify-center p-4 safe-area-top safe-area-bottom';
            aboutModal.innerHTML = `
                <div class="ios-card rounded-ios-xl p-6 max-w-sm w-full">
                    <div class="text-center mb-6">
                        <div class="w-16 h-16 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center mx-auto mb-4">
                            <span class="text-white text-xl font-bold">🐕</span>
                        </div>
                        <h3 class="text-xl font-bold text-white mb-2">BlueDog</h3>
                        <p class="text-ios-secondary text-sm">Enhanced Address Sniffer v2.1</p>
                    </div>
                    
                    <div class="space-y-4 text-sm">
                        <div>
                            <h4 class="text-white font-medium mb-2">Features</h4>
                            <ul class="text-ios-secondary space-y-1">
                                <li>• Real blockchain data fetching</li>
                                <li>• Multi-blockchain support</li>
                                <li>• Optimized Solana connection ⚡</li>
                                <li>• Advanced risk analysis</li>
                                <li>• Persistent data storage 💾</li>
                                <li>• Watchlist management</li>
                                <li>• Data export capabilities</li>
                                <li>• Activity visualization</li>
                            </ul>
                        </div>
                        
                        <div>
                            <h4 class="text-white font-medium mb-2">Supported Networks</h4>
                            <div class="flex space-x-2">
                                <span class="bg-blue-500/20 text-blue-400 px-2 py-1 rounded text-xs">Ethereum</span>
                                <span class="bg-purple-500/20 text-purple-400 px-2 py-1 rounded text-xs">Solana ⚡</span>
                                <span class="bg-orange-500/20 text-orange-400 px-2 py-1 rounded text-xs">Bitcoin</span>
                            </div>
                        </div>
                        
                        <div class="text-center pt-4 border-t border-white/10">
                            <p class="text-ios-secondary text-xs">Made By W1nR4r on telegram</p>
                            <p class="text-ios-secondary text-xs mt-1">© 2024 BlueDog Address Sniffer</p>
                        </div>
                    </div>
                    
                    <button onclick="this.closest('.fixed').remove()" 
                            class="w-full bg-ios-blue hover:bg-blue-600 text-white py-3 px-4 rounded-ios font-semibold transition-all duration-200 mt-6 address-item">
                        Close
                    </button>
                </div>
            `;
            
            document.body.appendChild(aboutModal);
            closeMenu();
        }

        function generateNewWalletList() {
            if (currentBlockchain) {
                showLoading();
                setTimeout(() => {
                    generateWalletData(currentBlockchain);
                }, 1500);
            }
        }

        function generateNewWallet() {
            if (currentBlockchain) {
                showLoading();
                setTimeout(() => {
                    generateWalletData(currentBlockchain);
                }, 1500);
            }
        }

        function retryDataFetch() {
            if (currentBlockchain) {
                showLoading();
                setTimeout(() => {
                    generateWalletData(currentBlockchain);
                }, 1000);
            }
        }

        function showError(message) {
            document.getElementById('loadingWallet').classList.add('hidden');
            document.getElementById('singleView').classList.add('hidden');
            document.getElementById('listView').classList.add('hidden');
            document.getElementById('errorDisplay').classList.remove('hidden');
            document.getElementById('errorMessage').textContent = message;
        }

        function resetApp() {
            currentBlockchain = '';
            isListView = false;
            currentWallet = null;
            currentTab = 'search';
            
            switchTab('search');
            
            document.getElementById('tabNavigation').classList.add('hidden');
            document.getElementById('blockchainSelection').classList.remove('hidden');
            document.getElementById('searchContent').classList.add('hidden');
            document.getElementById('loadingWallet').classList.add('hidden');
            document.getElementById('singleView').classList.add('hidden');
            document.getElementById('listView').classList.add('hidden');
            document.getElementById('errorDisplay').classList.add('hidden');
            document.getElementById('solanaLoadingIndicator').classList.add('hidden');
            
            document.getElementById('statusDot').className = 'status-dot';
            document.getElementById('statusText').textContent = 'Live';
            
            if (activityChart) {
                activityChart.destroy();
                activityChart = null;
            }
            
            saveSettings();
        }

        // Update Solana loading status indicators
        function updateSolanaLoadingStatus(status) {
            const statusDot = document.getElementById('statusDot');
            const statusText = document.getElementById('statusText');
            const loadingIndicator = document.getElementById('solanaLoadingIndicator');
            
            if (currentBlockchain !== 'sol') return;
            
            switch (status) {
                case 'connecting':
                    statusDot.className = 'status-dot solana-loading';
                    statusText.textContent = 'Connecting';
                    loadingIndicator.classList.remove('hidden');
                    break;
                case 'fetching':
                    statusText.textContent = 'Fetching';
                    break;
                case 'success':
                    statusDot.className = 'status-dot';
                    statusText.textContent = 'Live';
                    loadingIndicator.classList.add('hidden');
                    break;
                case 'fallback':
                    statusDot.className = 'status-dot';
                    statusText.textContent = 'Fallback';
                    loadingIndicator.classList.add('hidden');
                    break;
                case 'error':
                    statusDot.className = 'status-dot';
                    statusText.textContent = 'Error';
                    loadingIndicator.classList.add('hidden');
                    break;
            }
        }

        // Cache management for better performance
        function initCacheManagement() {
            const MAX_HISTORY_ITEMS = 50;
            const MAX_WATCHLIST_ITEMS = 100;
            
            function cleanupOldData() {
                if (searchHistory.length > MAX_HISTORY_ITEMS) {
                    searchHistory = searchHistory.slice(0, MAX_HISTORY_ITEMS);
                    saveHistory();
                }
                
                if (watchlist.length > MAX_WATCHLIST_ITEMS) {
                    watchlist = watchlist.slice(0, MAX_WATCHLIST_ITEMS);
                    saveWatchlist();
                }
                
                try {
                    let totalSize = 0;
                    for (let key in localStorage) {
                        if (localStorage.hasOwnProperty(key)) {
                            totalSize += localStorage[key].length * 2;
                        }
                    }
                    
                    const sizeInMB = totalSize / 1024 / 1024;
                    if (sizeInMB > 5) {
                        showNotification('Cleaning up old data...', 'warning');
                        searchHistory = searchHistory.slice(0, 30);
                        saveHistory();
                    }
                } catch (e) {
                    console.warn('Cache cleanup failed:', e);
                }
            }
            
            // Run cleanup every hour
            setInterval(cleanupOldData, 3600000);
        }

        // Initialize cache management
        initCacheManagement();

    </script>
</body>
</html>
